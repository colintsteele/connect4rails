<h1>Hello SalesLoft!</h1>
<p>Press the buttons below to drop discs onto the board.</p>

<div id="winner"></div>

<button onclick="reset()">Reset board</button>
<span id="player-turn"><%= @board.current_player.color%> player's turn</span>


<div id="board" style="position:relative;">
  <canvas id="canboard"
          height="<%=(@board.height*@canvas_scale)%>"
          width="<%=(@board.width*@canvas_scale)%>">
  </canvas>

  <script>
    $(document).ready(function(){
      //create buttons for dropping discs into columns
      <% 7.times do |i| %>
        $('<button/>', {
          id: 'drop_slot<%=i%>',
          class: 'drop_slot'
        }).on('click', function(){
          $.ajax({
            url: 'board/drop_disc?column=<%=i%>',
            type: 'GET',
            success: function(result){
              $('#player-turn').text("Computer player's turn");
              drawDisc(result.color, result.disc.column, result.disc.row);
              if (result.color == 'red') {
                setTimeout(function(){
                  drawDiscs();
                  $('#player-turn').text("red player's turn");
                }, 1000);
              }
              $.ajax({
                url: 'board/check_game_over',
                type: 'GET',
                success: function(status){
                  if(status.winner != undefined) {
                    drawDisc(status.disc.column, status.disc.row);
                    name = (status.winner == 3)? 'computer' : 'red';
                    if(confirm(name+" player has won!!  Press okay to reset the board"))
                      reset();
                  } else if (status.tie == "true"){
                    if(confirm("Tie!!  Press okay to reset the board."))
                      reset();
                  }
                }
              })
            }
          });
        }).appendTo($('#board'));
      <%end%>
    });
  </script>
</div>

<div id="progress-board"
     style="border-color: black;
     border-style: solid;
     border-radius: 2px;
     padding: 2px;
     float: right">

  <ul>
    <li class="done">Deploy</li>
    <li class="done">Disc logic</li>
    <li class="done">UI</li>
    <li class="done">Game logic</li>
    <li class="done">Win conditions</li>
    <li class="done">Database saves</li>
    <li class="done">AI</li>
  </ul>

</div>
<script type="text/javascript">
</script>
